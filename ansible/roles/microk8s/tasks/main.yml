---
- name: Install microk8s
  community.general.snap:
    name:
      - microk8s
    classic: true

- name: check micrik8s status
  ansible.builtin.shell:
    cmd: microk8s status --format yaml
  register: microk8s_status_cmd

#- name: debug
#  debug:
#    var: microk8s_status_cmd

- name: checking metallb status
  set_fact:
    microk8s_metallb_status: "{{(microk8s_status_cmd.stdout | from_yaml).addons | selectattr('name', 'equalto','metallb') | first }}"



- name: enable microk8s metallb
  ansible.builtin.shell:
    cmd: microk8s enable metallb
  register: microk8s_enable_metallb_cmd
  when: microk8s_metallb_status.status == "disabled"
